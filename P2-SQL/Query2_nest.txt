SELECT N_NAME, sum(total)
FROM (SELECT N_NAME, sum(L_QUANTITY * (L_EXTENDEDPRICE - L_DISCOUNT)) as total
      FROM NATION,
           SUPPLIER,
           LINEITEM,
           CUSTOMER,
           ORDERS
      WHERE N_NATIONKEY = S_NATIONKEY
        AND N_NATIONKEY = C_NATIONKEY
        AND C_CUSTKEY = O_CUSTKEY
        AND O_ORDERKEY = L_ORDERKEY
        AND S_SUPPKEY = L_SUPPKEY
      GROUP BY L_ORDERKEY, L_SUPPKEY
     )
GROUP BY N_NAME
